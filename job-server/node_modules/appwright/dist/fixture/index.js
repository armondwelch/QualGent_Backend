"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.expect = exports.test = void 0;
const test_1 = require("@playwright/test");
const providers_1 = require("../providers");
exports.test = test_1.test.extend({
    deviceProvider: async ({}, use, testInfo) => {
        const deviceProvider = (0, providers_1.createDeviceProvider)(testInfo.project);
        await use(deviceProvider);
    },
    device: async ({ deviceProvider }, use, testInfo) => {
        const device = await deviceProvider.getDevice();
        await deviceProvider.syncTestDetails({ name: testInfo.title });
        await use(device);
        await device.close();
    },
    saveVideo: [
        async ({ deviceProvider }, use, testInfo) => {
            await use();
            await deviceProvider.syncTestDetails({
                status: testInfo.status,
                reason: testInfo.error?.message,
            });
            const outputDir = testInfo.project.outputDir;
            const videoData = await deviceProvider.downloadVideo(outputDir, testInfo.testId);
            if (videoData) {
                await testInfo.attach("video", videoData);
            }
        },
        { auto: true },
    ],
});
exports.expect = exports.test.expect.extend({
    toBeVisible: async (locator, options) => {
        const isVisible = await locator.isVisible(options);
        return {
            message: () => (isVisible ? "" : `Element was not found on the screen`),
            pass: isVisible,
            name: "toBeVisible",
            expected: true,
            actual: isVisible,
        };
    },
});
